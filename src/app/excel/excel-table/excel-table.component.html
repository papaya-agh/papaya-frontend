<app-menubar [userRole]="this.store.currentProject?.userRole"
             [currentProjectName]="this.store.currentProject?.name"></app-menubar>
<p-toast position="top-center"></p-toast>
<p-card header="Podsumowanie dostępności">
  <ng-template [ngIf]="isLoaded && declarableSprint">
    <div class="ui-g" id="availability-table">
      <div class="ui-g-8">
        <p:commandButton icon="pi pi-arrow-left" 
                         (click)="prevSprint()"/>
        <h5>
          Dostępność dla sprintu: <span class="bold">{{sprintStartDate | date: 'dd-MM-yyy'}}</span> - <span class="bold">{{sprintEndDate | date: 'dd-MM-yyyy'}}</span>
        </h5>
        <p:commandButton icon="pi pi-arrow-right" 
                         (click)="nextSprint"/>
        <h5>
          Ilość godzin do zaplanowania: <span class="bold">{{timeToAssign}}</span>
        </h5>
        <h5>
          Współczynnik: <span class="bold">{{sprint.coefficient}}</span>
        </h5>
        <div *ngIf="sprintStateMap[declarableSprint.sprintState]"
             class="during">{{sprintStateMap[declarableSprint.sprintState]}}</div>
        <p-table [value]="workers">
          <ng-template pTemplate="header">
            <th>Lp.</th>
            <th>Osoba</th>
            <th>Zadeklarowane godziny</th>
            <th>Efektywne godziny</th>
            <th>Zaległe godziny</th>
            <th>Notatki</th>
          </ng-template>
          <ng-template pTemplate="body" let-worker let-i="rowIndex">
            <tr>
              <td>{{i + 1}}</td>
              <td [ngClass]="{'gray-user': worker.timeAvailable==''}">
                {{worker.name}}
              </td>
              <td>{{worker.timeAvailable}}</td>
              <td>{{worker.effectiveTimeAvailable}}</td>
              <td>{{worker.timeRemaining}}</td>
              <td>{{worker.notes}}</td>
            </tr>
          </ng-template>
        </p-table>
        <hr>
      </div>
    </div>
    <div id="availability-summary">
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Początkowy oszacowany czas</h5>
        </div>
        <div class="ui-g-1">
          <span>{{declarableSprint.estimatedTimePlanned}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Ostateczny zaplanowany czas</h5>
        </div>
        <div class="ui-g-1">
          <span>{{declarableSprint.finalTimePlanned}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Wypracowane godziny</h5>
        </div>
        <div class="ui-g-1">
          <span>{{declarableSprint.timeBurned}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Suma godzin</h5>
        </div>
        <div class="ui-g-1">
          <span>{{totalDeclaredTime}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Potrzebny efektywny czs</h5>
        </div>
        <div class="ui-g-1">
          <span>{{totalNeededTime}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Aktualny współczynnik</h5>
        </div>
        <div class="ui-g-1">
          <span>{{currentAverageSprintCoefficient}}</span>
        </div>
      </div>
      <div class="ui-g">
        <div class="ui-g-2">
          <h5>Średni historyczny współczynnik</h5>
        </div>
        <div class="ui-g-1">
          <span>{{prevAverageSprintCoefficient}}</span>
        </div>
      </div>
    </div>

    <div class="ui-g-12">
      <p>L20: {{declarableSprint.estimatedTimePlanned}}</p>
      <p>L21: {{declarableSprint.finalTimePlanned}}</p>
      <p>L22: {{declarableSprint.timeBurned}}</p>
    </div>

    <p-button *ngIf="declarableSprint.sprintState === 'FINISHED'"
              label="Zamknij sprint" icon="pi pi-check"
              (click)="closeSprint()"
              class="mr-2">
    </p-button>

    <p-button *ngIf="declarableSprint.sprintState !== 'UPCOMING'"
              label="Synchronizuj z Jirą" icon="pi pi-refresh"
              (click)="synchronizeWithJira()"
              class="mb-2">
    </p-button>

    <ng-template [ngIf]="isSynchronized">
      <h6>Dostępne sprinty:</h6>
      <p-table [value]="jiraSprints">
        <ng-template pTemplate="header">
          <tr>
            <th>Nazwa</th>
            <th>Data rozpoczęcia</th>
            <th>Stan</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-jiraSprint>
          <tr>
            <td>{{jiraSprint.name}}</td>
            <td>{{jiraSprint.startDate}}</td>
            <td>{{jiraSprint.state}}</td>
            <td>
              <p-button icon="pi pi-arrow-right"
                        (onClick)="chooseJiraSprint(jiraSprint)">
              </p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>

  </ng-template>
  <ng-template [ngIf]="isLoaded && !declarableSprint">
    <div>
      Obecnie nie ma żadnego sprintu, dla którego można wyświetlić dostępność
    </div>
  </ng-template>

</p-card>
