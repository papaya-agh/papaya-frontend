<app-menubar [userRole]="this.store.currentProject?.userRole"
             [currentProjectName]="this.store.currentProject?.name"></app-menubar>
<p-toast position="top-center"></p-toast>
<p-card header="Podsumowanie dostępności">
  <ng-template [ngIf]="isLoaded && currentSprint && sprintSummary">
    <div class="ui-g" id="availability-table">
      <div class="ui-g-12">
        <div class="ui-g-12">
          <div class="ui-g-1">
            <p-button icon="pi pi-arrow-left"
                      class="left"
                      (click)="onPrevClick()">
            </p-button>
          </div>

          <div class="ui-g-10 d-flex justify-content-center">
            <div>
              <h5>
                Dostępność dla sprintu: <br/>
                <span class="bold">{{currentSprint.durationPeriod.start | date: 'dd-MM-yyy'}}</span> -
                <span class="bold">{{currentSprint.durationPeriod.end | date: 'dd-MM-yyyy'}}</span>
              </h5>
              <h5>
                Liczba godzin do zaplanowania: <span class="bold">{{formatNumber(sprintSummary.timeToAssign)}}</span>
              </h5>
              <h5>
                Współczynnik: <span class="bold">{{currentSprint.coefficient}}</span>
              </h5>
            </div>
          </div>

          <div class="ui-g-1">
            <p-button icon="pi pi-arrow-right"
                      class="right"
                      (click)="onNextClick()">
            </p-button>
          </div>
        </div>
        <div *ngIf="sprintStateMap[currentSprint.sprintState]"
             class="during">{{sprintStateMap[currentSprint.sprintState]}}</div>
        <p-table [value]="(sprintSummary.membersAvailability | workers: projectMembersById)">
          <ng-template pTemplate="header">
            <tr>
              <th>Osoba</th>
              <th>Zadeklarowane godziny</th>
              <th>Efektywne godziny</th>
              <th>Zaległe godziny</th>
              <th>Notatki</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-worker>
            <tr>
              <td [ngClass]="{'gray-user': worker.timeAvailable==''}">
                {{worker.name}}
              </td>
              <td>{{worker.timeAvailable}}</td>
              <td>{{worker.effectiveTimeAvailable}}</td>
              <td>{{worker.timeRemaining}}</td>
              <td>{{worker.notes}}</td>
            </tr>
          </ng-template>
        </p-table>
        <hr>
      </div>
    </div>

    <div id="availability-summary">
      <div class="ui-g">
        <div class="ui-g-2 normal">
          <h5>Początkowy oszacowany czas</h5>
        </div>
        <div class="ui-g-1 number-size text-center normal">
          <span>{{currentSprint.estimatedTimePlanned | TimeFormater}}</span>
        </div>
        <div class="ui-g-2 normal">
          <h5>Ostateczny zaplanowany czas</h5>
        </div>
        <div class="ui-g-1 number-size text-center normal">
          <span>{{currentSprint.finalTimePlanned | TimeFormater}}</span>
        </div>
        <div class="ui-g-2 normal">
          <h5>Wypracowane godziny</h5>
        </div>
        <div class="ui-g-1 number-size text-center normal">
          <span>{{currentSprint.timeBurned | TimeFormater}}</span>
        </div>
        <div class="ui-g-2 effective">
          <h5>Suma godzin</h5>
        </div>
        <div class="ui-g-1 number-size text-center effective">
          <span>{{formatNumber(sprintSummary.totalDeclaredTime)}}</span>
        </div>
        <div class="ui-g-2 effective">
          <h5>Potrzebny efektywny czas</h5>
        </div>
        <div class="ui-g-1 number-size text-center effective">
          <span>{{formatNumber(sprintSummary.totalNeededTime)}}</span>
        </div>
        <div class="ui-g-2 effective">
          <h5>Aktualny współczynnik</h5>
        </div>
        <div class="ui-g-1 number-size text-center effective">
          <span>{{roundNumber(sprintSummary.currentAverageSprintCoefficient)}}</span>
        </div>
        <div class="ui-g-2 historical">
          <h5>Średni historyczny współczynnik</h5>
        </div>
        <div class="ui-g-1 number-size text-center historical">
          <span>{{roundNumber(sprintSummary.prevAverageSprintCoefficient)}}</span>
        </div>
      </div>
    </div>

    <p-button *ngIf="currentSprint.sprintState === 'FINISHED'"
              label="Zamknij sprint" icon="pi pi-check"
              (click)="closeSprint()"
              class="mr-2">
    </p-button>

    <p-button *ngIf="currentSprint.sprintState !== 'UPCOMING'"
              label="Synchronizuj z Jirą" icon="pi pi-refresh"
              (click)="synchronizeWithJira()"
              class="mb-2">
    </p-button>

    <ng-template [ngIf]="isSynchronized">
      <h6>Dostępne sprinty:</h6>
      <p-table [value]="jiraSprints">
        <ng-template pTemplate="header">
          <tr>
            <th>Nazwa</th>
            <th>Data rozpoczęcia</th>
            <th>Stan</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-jiraSprint>
          <tr class="highlight-on-hover-content clickable" (click)="chooseJiraSprint(jiraSprint)">
            <td>{{jiraSprint.name}}</td>
            <td>{{jiraSprint.startDate}}</td>
            <td>{{jiraSprint.state}}</td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>

  </ng-template>
  <ng-template [ngIf]="isLoaded && !currentSprint">
    <div>
      Obecnie nie ma żadnego sprintu, dla którego można wyświetlić dostępność
    </div>
  </ng-template>

</p-card>
